# Shadow System v2.0

## Overview
SHADOW SYSTEM iO v2.0 is a professional Ukrainian-language Telegram marketing automation platform. It provides comprehensive functionality for managing bot networks, mass mailings, OSINT reconnaissance, team collaboration, and AI-powered features. The system uses SHADOW license keys for authorization (no payment/balance system).

## User Preferences
- Concise, high-level summaries over granular details
- No changelogs or date-wise entries
- Focus on core architectural decisions
- Ukrainian interface with styled formatting (dividers, emoji, button layouts)

## System Architecture

### Directory Structure
```
├── bot.py                  # Main entry point
├── config/                 # Configuration (settings, tariffs)
├── core/                   # Core services
│   ├── ai_service.py       # AI/GPT integration (GPT-5)
│   ├── role_constants.py   # Single source of truth for UserRole
│   ├── roles.py            # Permission system
│   ├── rate_limiter.py     # Token bucket rate limiting
│   ├── message_queue.py    # Async message queue (3 workers)
│   ├── mailing_scheduler.py# Campaign scheduling
│   ├── anti_fraud.py       # Behavioral analysis
│   ├── segmentation.py     # User tagging
│   └── alerts.py           # Notification system
├── database/
│   ├── models.py           # SQLAlchemy models (User, Funnel, FunnelStep, etc.)
│   └── crud.py             # Database operations
├── handlers/               # Telegram command handlers
├── keyboards/              # Role-specific menus
├── middlewares/            # Security, role checking
├── services/               # Business logic (user_service, funnel_service)
└── utils/                  # Database utilities
```

### Core Architectural Decisions
- **Unified Role System:** Single `UserRole` class in `core/role_constants.py` imported by all modules
- **RBAC:** ROOT/ADMIN, LEADER, MANAGER, GUEST with hierarchical permissions
- **FSM Navigation:** Proper state clearing on back navigation
- **Async Operations:** aiogram 3.3 + asyncpg for non-blocking I/O
- **Security-First:** SHADOW keys, Telegram ID binding, IP whitelists, audit logging
- **AI Integration:** Replit AI Integrations (OpenAI-compatible, GPT-5)

### Role Hierarchy
| Role | Level | Access |
|------|-------|--------|
| GUEST | 0 | View tariffs, submit applications |
| MANAGER | 1 | Mailings, OSINT, botnet |
| LEADER | 2 | Team management, funnels, license generation |
| ADMIN | 3 | Full system control |

## Key Features

### Implemented
- **Bot Network:** Session import, encryption, warming cycles, proxy management
- **Campaigns:** Broadcast, targeted, drip, sequential with A/B testing
- **OSINT:** Telegram analysis, DNS/WHOIS, geo scanner, AI reports
- **Funnels:** Full CRUD with photo support, tariff config, statistics
- **AI Services:** Text generation, sentiment analysis, OSINT reports, message rewriting
- **Security:** Rate limiting, anti-fraud, encrypted sessions, audit logs
- **Team CRM:** Manager management, invite codes, referrals

### Services (19 Active)
1. RateLimiter (30 req/sec global)
2. MessageQueue (3 workers)
3. MailingScheduler
4. AntiFraud
5. Segmentation
6. KeyNotifications
7. SecurityCache
8. AuditLogger
9. EncryptionManager
10. AIService

## External Dependencies
- **aiogram 3.3:** Telegram Bot API
- **SQLAlchemy + asyncpg:** PostgreSQL database
- **Telethon:** Session management
- **OpenAI (via Replit AI):** AI features
- **ReportLab:** PDF generation
- **Jinja2:** HTML templates

## Authorization
- **Leaders:** SHADOW keys (unique, ID-bound)
- **Managers:** INV codes (generated by Leaders)
- No payment/balance system - pure license activation

## UI/UX Standards
- Ukrainian language throughout
- Dividers: ═══════════════════════
- Button layouts: 1/2/3 per row
- HTML formatting: <b>, <i>, <code>
- Lists: ├ └ tree structure
